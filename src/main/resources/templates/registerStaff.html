<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="utf-8">
  <title>Minton - Responsive Admin Dashboard Template</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description">
  <meta content="Coderthemes" name="author">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- App favicon -->
  <link rel="shortcut icon" href="assets\images\favicon.ico">

  <!-- App css -->
  <th:block th:insert="layout/header :: app-css"/>
  <style>
    .locationCss {
      padding: 0.5rem 1rem;
      border-radius: 3px;
      border: 1px solid #ced4da;
      color: #555c61;
      width: 100%;
    }
  </style>

</head>

<body>

<div class="account-pages mt-5 mb-5">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6 col-xl-5">
        <div class="card">

          <div class="card-body p-4">

            <div class="text-center w-75 m-auto">
              <a href="index.html">
                <span><img src="assets\images\logo-dark.png" alt="" height="22"></span>
              </a>
              <h1 class="text-muted mb-4 mt-3">Register </h1>
            </div>

            <form action="#" id="">
              <div class="row" >

                <div class="form-group col-6">
                  <label for="staffName">UserName</label>
                  <input class="form-control" type="text" id="staffName" placeholder="Enter your name" required=""
                         onblur="onBlur(this)" oninput="onInput(this)" onfocus="onFocus(this)">
                  <span id="staffName-error" class="invalid-feedback"></span>
                </div>
                <div class="form-group col-6">
                  <label for="password">Password</label>
                  <input class="form-control" type="password" required="" id="password" placeholder="Enter your password"
                         onblur="onBlur(this)" oninput="onInput(this)" onfocus="onFocus(this)">
                  <span id="password-error" class="invalid-feedback"></span>
                </div>
              </div>
              <div class="row">
                <div class="form-group col-6">
                  <label for="fullNameCre">Full Name</label>
                  <input class="form-control" type="text" id="fullNameCre" placeholder="Enter your name" required=""
                         onblur="onBlur(this)" oninput="onInput(this)" onfocus="onFocus(this)">
                  <span id="fullNameCre-error" class="invalid-feedback"></span>
                </div>
                <div class="form-group col-6">
                  <label for="emailCre">Email address</label>
                  <input class="form-control" type="email" id="emailCre" required="" placeholder="Enter your email"
                         onblur="onBlur(this)" oninput="onInput(this)" onfocus="onFocus(this)">
                  <span id="emailCre-error" class="invalid-feedback"></span>
                </div>
              </div>
              <div class="row">
                <div class="form-group col-6">
                  <label for="phoneCre">Phone</label>
                  <input class="form-control" type="text" id="phoneCre" required="" placeholder="Enter your phone"
                         onblur="onBlur(this)" oninput="onInput(this)" onfocus="onFocus(this)">
                  <span id="phoneCre-error" class="invalid-feedback"></span>
                </div>
                <div class="form-group col-6">
                  <label for="ageCre">Age</label>
                  <input class="form-control" type="number" id="ageCre" required="" placeholder="Enter your age"
                         onblur="onBlur(this)" oninput="onInput(this)" onfocus="onFocus(this)">
                  <span id="ageCre-error" class="invalid-feedback"></span>
                </div>
              </div>
              <div class="row">
                <div class="form-group col-6">
                  <label for="provinceCre">Province</label>
                  <select name="" id="provinceCre" class="form-select locationCss"></select>
                </div>
                  <div class="form-group col-6">
                    <label for="districtCre">District</label>
                    <select name="" id="districtCre" class="form-select locationCss"></select>
                  </div>
              </div>
              <div class="row">
                <div class="form-group col-6">
                  <label for="wardCre">Ward</label>
                  <select name="" id="wardCre" class="form-select locationCss"></select>
                </div>
                <div class="form-group col-6">
                  <label for="addressCre">Address</label>
                  <input type="text" id="addressCre" class="form-control" placeholder="Enter your address"
                         onblur="onBlur(this)" oninput="onInput(this)" onfocus="onFocus(this)">
                  <span id="addressCre-error" class="invalid-feedback"></span>
                </div>
              </div>
              <div class="form-group">
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="checkbox-signup">
                  <label class="custom-control-label" for="checkbox-signup">I accept <a href="javascript: void(0);" class="text-dark">Terms and Conditions</a></label>
                </div>
              </div>
              <div class="form-group mb-0 text-center">
                <button class="btn btn-primary btn-block" type="submit" id="btnCreate"> Sign Up </button>
              </div>
            </form>

            <div class="text-center">
              <h5 class="mt-3 text-muted">Sign up using</h5>
              <ul class="social-list list-inline mt-3 mb-0">
                <li class="list-inline-item">
                  <a href="javascript: void(0);" class="social-list-item border-primary text-primary"><i class="mdi mdi-facebook"></i></a>
                </li>
                <li class="list-inline-item">
                  <a href="javascript: void(0);" class="social-list-item border-danger text-danger"><i class="mdi mdi-google"></i></a>
                </li>
                <li class="list-inline-item">
                  <a href="javascript: void(0);" class="social-list-item border-info text-info"><i class="mdi mdi-twitter"></i></a>
                </li>
                <li class="list-inline-item">
                  <a href="javascript: void(0);" class="social-list-item border-secondary text-secondary"><i class="mdi mdi-github-circle"></i></a>
                </li>
              </ul>
            </div>

          </div> <!-- end card-body -->
        </div>
        <!-- end card -->

        <div class="row mt-3">
          <div class="col-12 text-center">
            <p class="text-muted">Already have account?  <a href="pages-login.html" id="" class="text-muted font-weight-medium ml-1">Sign In</a></p>
          </div> <!-- end col -->
        </div>
        <!-- end row -->

      </div> <!-- end col -->
    </div>
    <!-- end row -->
  </div>
  <!-- end container -->
</div>
<!-- end page -->


<footer class="footer footer-alt">
  2016 - 2019 &copy; Minton theme by <a href="" class="text-muted">Coderthemes</a>
</footer>

<!-- Vendor js -->
<script src="/assets\js\vendor.min.js"></script>

<!-- App js -->
<script src="/assets\js\app.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
<script>
  function renderOptionProvince(obj){
    return `<option value="${obj.province_id}">${obj.province_name}</option>`;
  }

  function renderOptionDistrict(obj) {
    return `<option value="${obj.district_id}">${obj.district_name}</option>`;
  }

  function renderOptionWard(obj) {
    return `<option value="${obj.ward_id}">${obj.ward_name}</option>`;
  }
  $('#provinceCre').on('change', function () {
    const provinceId = $(this).val();
    getAllDistrictsByProvinceId(provinceId);
  })
  function getAllProvinces(){
    $.ajax({
      url: 'https://vapi.vnappmob.com/api/province/'
    })
            .done((data) => {
              const provinces = data.results;
              const provinceId = provinces[0].province_id;
              let result = '';
              $.each(provinces, (index, item) => {
                const str = renderOptionProvince(item);
                result+= str;
              })
              document.getElementById('provinceCre').innerHTML = result

              getAllDistrictsByProvinceId(provinceId);
            })
            .fail((error) => {
              console.log(error);
            })
  }
  function getAllDistrictsByProvinceId(provinceId){
    $.ajax({
      url: 'https://vapi.vnappmob.com/api/province/district/' + provinceId
    })
            .done((data) => {
              const districts = data.results;
              const districtId = districts[0].district_id;

              $('#districtCre').empty();

              $.each(districts, (index, item) => {
                const str = renderOptionDistrict(item);
                $('#districtCre').append(str);
              })

              getAllWardsByDistrictId(districtId);
            })
            .fail((error) => {
              console.log(error);
            })
  }
  function getAllWardsByDistrictId(districtId) {
    $.ajax({
      url: 'https://vapi.vnappmob.com/api/province/ward/' + districtId
    })
            .done((data) => {
              const wards = data.results;

              $('#wardCre').empty();

              $.each(wards, (index, item) => {
                const str = renderOptionWard(item);
                $('#wardCre').append(str);
              })
            })
            .fail((error) => {
              console.log(error);
            })
  }


  $("#provinceCre").on("change", function() {
    const provinceId = $(this).val();
    getAllDistrictsByProvinceId(provinceId, $("#districtCre"), function(data) {
      const districtId = data.results[0].district_id;
      getAllWardsByDistrictId(districtId, $("#wardCre"));
    });
  });
  $("#districtCre").on("change", function() {
    const districtId = $(this).val();
    getAllWardsByDistrictId(districtId, $("#wardCre"));
  });
  getAllProvinces();

  $('#btnCreate').on('click', function () {
    const invalidElements = document.getElementsByClassName("is-invalid");
    if (invalidElements.length > 0) {
      swal.fire({
        icon: 'error',
        title: 'Error',
        text: "There are errors on the form. Please correct them before submitting !!!",
      });
    } if ($("#password").val() === "" || $("#staffName").val() === "" || $("#fullName").val() === "" || $("#emailCre").val() === "" || $("#phoneCre").val() === "" || $("#ageCre").val() === "" || $("#addressCre").val() === "") {
      swal.fire({
        icon: 'error',
        title: 'Error',
        text: "Please fill out all information before submitting !!!",
      });
    } else {
      const provinceSelectCre = document.getElementById('provinceCre');
      const districtCre = document.getElementById('districtCre');
      const wardCre = document.getElementById('wardCre');
      const fullName = $('#fullNameCre').val();
      const staffName = $('#staffName').val();
      const password = $('#password').val();
      const email = $('#emailCre').val();
      const phone = $('#phoneCre').val();
      const age = $('#AgeCre').val()
      const provinceId = $('#provinceCre').val();
      const provinceName = provinceSelectCre.options[provinceSelectCre.selectedIndex].innerHTML;
      const districtId = $('#districtCre').val();
      const districtName = districtCre.options[districtCre.selectedIndex].innerHTML;
      const wardId = $('#wardCre').val();
      const wardName = wardCre.options[wardCre.selectedIndex].innerHTML;
      const address = $('#addressCre').val();

      const requestData = {
        fullName : fullName,
        staffName :staffName,
        password : password,
        email :email,
        phone :phone,
        age: age,
        locationRegion :{
          provinceId : provinceId,
          provinceName : provinceName,
          districtId : districtId,
          districtName : districtName,
          wardId : wardId,
          wardName : wardName,
          address : address
        }
      };
      console.log(requestData)
      $.ajax({
        type: 'POST',
        url: '/api/staffs/create',
        contentType:'application/json',
        data: JSON.stringify(requestData),
        success: function (response) {
          console.log(response);

          $('#modalCreate').modal('hide');
          document.getElementById("closeCreate").click();
          document.getElementById("create").reset();
          showStaff();

        },
        error: function (error) {
          console.log(error);
        }
      });
    }

  });

  let isError = false;
  function checkInput(input) {
    let value = input.value;
    let regex;
    let message;
    switch (input.id) {
      case "staffName":
        if (value === "") {
          message = "Username can't be empty";
          return {
            error: false,
            message
          }
        } else if (value.length < 5 || value.length > 15) {
          message = "Username must be between 5 and 15 characters long";
          return {
            error: false,
            message
          }
        } else {
          regex = /^[a-zA-Z0-9]{1,15}$/;
          message = "Username can't have special characters"
          return {
            error: regex.test(value),
            message
          }
        }
      case "password":
        if (value === "") {
          message = "Password can't be empty";
          return {
            error: false,
            message
          }
        } else if (value.length < 5 || value.length > 15) {
          message = "Password must be between 5 and 15 characters long";
          return {
            error: false,
            message
          }
        } else {
          regex = /^[a-zA-Z0-9]{1,15}$/;
          message = "Password can't have special characters"
          return {
            error: regex.test(value),
            message
          };
        }
      case "fullNameCre":
        if (value === "") {
          message = "Full name can't be empty";
          return {
            error: false,
            message
          }
        } else {
          regex = /^[a-zA-ZÀ-Ỹà-ỹ]+( [a-zA-ZÀ-Ỹà-ỹ]+)*$/;
          message = "Full name can't have special characters";
          return {
            error: regex.test(value),
            message
          }
        }
      case "phoneCre":
        if (value === "") {
          message = "Phone can't be empty";
          return {
            error: false,
            message
          }
        } else {
          regex = /^0[0-9]{9}$/;
          message = "Phone number must have 10 digits and start with 0";
          return {
            error: regex.test(value),
            message
          }
        }
      case "emailCre":
        if (value === "") {
          message = "Email can't be empty";
          return {
            error: false,
            message
          }
        } else {
          regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.(com|edu|net|org|biz|info|vn|pro)$/;
          message = "Email with invalid domain name";
          return {
            error: regex.test(value),
            message
          }
        }
      case "addressCre":
        if (value === "") {
          message = "Address can't be empty";
          return {
            error: false,
            message
          }
        } else {
          regex = /^[a-zA-ZÀ-Ỹà-ỹ]+( [a-zA-ZÀ-Ỹà-ỹ,./]+)*$/;
          message = "The address cannot have any special characters other than , . /";
          return {
            error: regex.test(value),
            message
          }
        }
      case "ageCre":
        if (value === "") {
          message = "Age can't be empty";
          return {
            error: false,
            message
          }
        } else if (value < 18 || value > 25) {
          message = "Age must be between 16 and 69";
          return {
            error: false,
            message
          }
        } else {
          regex = /^\d+$/;
          message = "Age is only allowed to enter numbers";
          return {
            error: regex.test(value),
            message
          }
        }
      case "provinceCre":
        if (value === "") {
          message = "Province can't be empty";
          return {
            error: false,
            message
          }
        }

    }
  }



  const onBlur = (input) => {
    let errorStatus = checkInput(input)
    if (!errorStatus.error) {
      isError = true;
      document.getElementById(input.id + '-error').innerText = errorStatus.message;
    } else {
      isError = false;
      document.getElementById(input.id + '-error').innerText = "";
    }
    input.classList.remove("is-invalid", "is-valid");
    input.classList.add(isError ? "is-invalid" : "is-valid");
  }

  const onInput = (input) => {
    let errorStatus = checkInput(input)
    isError = !errorStatus.error;
    console.log(isError)
    input.classList.remove("is-invalid", "is-valid");
    input.classList.add(isError ? "is-invalid" : "is-valid");
  }

  const onFocus = (input) => {
    document.getElementById(input.id + '-error').innerText = "";
    // document.getElementById(input.id + '-error-submit').innerText = "";
  }

  const onClick = (input) => {
    input.classList.remove("is-invalid", "is-valid");
    document.getElementById(input.id + '-error').innerText = "";
    // document.getElementById(input.id + '-error-submit').innerText = "";
  }
</script>
</html>