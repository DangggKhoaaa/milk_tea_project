<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="utf-8">
  <title>Minton - Responsive Admin Dashboard Template</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description">
  <meta content="Coderthemes" name="author">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- App favicon -->
  <link rel="shortcut icon" href="assets\images\favicon.ico">

  <!-- App css -->
  <th:block th:insert="layout/header :: app-css"/>
  <style>
    .locationCss {
      padding: 0.5rem 1rem;
      border-radius: 3px;
      border: 1px solid #ced4da;
      color: #555c61;
      width: 100%;
    }
  </style>

</head>

<body>

<div class="account-pages mt-5 mb-5">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6 col-xl-5">
        <div class="card">

          <div class="card-body p-4">

            <div class="text-center w-75 m-auto">
              <a href="index.html">
                <span><img src="assets\images\logo-dark.png" alt="" height="22"></span>
              </a>
              <h1 class="text-muted mb-4 mt-3">Register </h1>
            </div>

            <form action="#" id="">
              <div class="row" >

                <div class="form-group col-6">
                  <label for="staffName">UserName</label>
                  <input class="form-control" type="text" id="staffName" placeholder="Enter your name" required="">
                </div>
                <div class="form-group col-6">
                  <label for="password">Password</label>
                  <input class="form-control" type="password" required="" id="password" placeholder="Enter your password">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-6">
                  <label for="fullNameCre">Full Name</label>
                  <input class="form-control" type="text" id="fullNameCre" placeholder="Enter your name" required="">
                </div>
                <div class="form-group col-6">
                  <label for="emailCre">Email address</label>
                  <input class="form-control" type="email" id="emailCre" required="" placeholder="Enter your email">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-6">
                  <label for="phoneCre">Phone</label>
                  <input class="form-control" type="text" id="phoneCre" required="" placeholder="Enter your phone">
                </div>
                <div class="form-group col-6">
                  <label for="AgeCre">Age</label>
                  <input class="form-control" type="number" id="AgeCre" required="" placeholder="Enter your age">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-6">
                  <label for="provinceCre">Province</label>
                  <select name="" id="provinceCre" class="form-select locationCss"></select>
                </div>
                  <div class="form-group col-6">
                    <label for="districtCre">District</label>
                    <select name="" id="districtCre" class="form-select locationCss"></select>
                  </div>
              </div>
              <div class="row">
                <div class="form-group col-6">
                  <label for="wardCre">Ward</label>
                  <select name="" id="wardCre" class="form-select locationCss"></select>
                </div>
                <div class="form-group col-6">
                  <label for="addressCre">Address</label>
                  <input type="text" id="addressCre" class="form-control">
                </div>
              </div>
              <div class="form-group">
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="checkbox-signup">
                  <label class="custom-control-label" for="checkbox-signup">I accept <a href="javascript: void(0);" class="text-dark">Terms and Conditions</a></label>
                </div>
              </div>
              <div class="form-group mb-0 text-center">
                <button class="btn btn-primary btn-block" type="submit" id="btnCreate"> Sign Up </button>
              </div>
            </form>

            <div class="text-center">
              <h5 class="mt-3 text-muted">Sign up using</h5>
              <ul class="social-list list-inline mt-3 mb-0">
                <li class="list-inline-item">
                  <a href="javascript: void(0);" class="social-list-item border-primary text-primary"><i class="mdi mdi-facebook"></i></a>
                </li>
                <li class="list-inline-item">
                  <a href="javascript: void(0);" class="social-list-item border-danger text-danger"><i class="mdi mdi-google"></i></a>
                </li>
                <li class="list-inline-item">
                  <a href="javascript: void(0);" class="social-list-item border-info text-info"><i class="mdi mdi-twitter"></i></a>
                </li>
                <li class="list-inline-item">
                  <a href="javascript: void(0);" class="social-list-item border-secondary text-secondary"><i class="mdi mdi-github-circle"></i></a>
                </li>
              </ul>
            </div>

          </div> <!-- end card-body -->
        </div>
        <!-- end card -->

        <div class="row mt-3">
          <div class="col-12 text-center">
            <p class="text-muted">Already have account?  <a href="pages-login.html" id="" class="text-muted font-weight-medium ml-1">Sign In</a></p>
          </div> <!-- end col -->
        </div>
        <!-- end row -->

      </div> <!-- end col -->
    </div>
    <!-- end row -->
  </div>
  <!-- end container -->
</div>
<!-- end page -->


<footer class="footer footer-alt">
  2016 - 2019 &copy; Minton theme by <a href="" class="text-muted">Coderthemes</a>
</footer>

<!-- Vendor js -->
<script src="/assets\js\vendor.min.js"></script>

<!-- App js -->
<script src="/assets\js\app.min.js"></script>

</body>
<script>
  function renderOptionProvince(obj){
    return `<option value="${obj.province_id}">${obj.province_name}</option>`;
  }

  function renderOptionDistrict(obj) {
    return `<option value="${obj.district_id}">${obj.district_name}</option>`;
  }

  function renderOptionWard(obj) {
    return `<option value="${obj.ward_id}">${obj.ward_name}</option>`;
  }
  $('#provinceCre').on('change', function () {
    const provinceId = $(this).val();
    getAllDistrictsByProvinceId(provinceId);
  })
  function getAllProvinces(){
    $.ajax({
      url: 'https://vapi.vnappmob.com/api/province/'
    })
            .done((data) => {
              const provinces = data.results;
              const provinceId = provinces[0].province_id;
              let result = '';
              $.each(provinces, (index, item) => {
                const str = renderOptionProvince(item);
                result+= str;
              })
              document.getElementById('provinceCre').innerHTML = result

              getAllDistrictsByProvinceId(provinceId);
            })
            .fail((error) => {
              console.log(error);
            })
  }
  function getAllDistrictsByProvinceId(provinceId){
    $.ajax({
      url: 'https://vapi.vnappmob.com/api/province/district/' + provinceId
    })
            .done((data) => {
              const districts = data.results;
              const districtId = districts[0].district_id;

              $('#districtCre').empty();

              $.each(districts, (index, item) => {
                const str = renderOptionDistrict(item);
                $('#districtCre').append(str);
              })

              getAllWardsByDistrictId(districtId);
            })
            .fail((error) => {
              console.log(error);
            })
  }
  function getAllWardsByDistrictId(districtId) {
    $.ajax({
      url: 'https://vapi.vnappmob.com/api/province/ward/' + districtId
    })
            .done((data) => {
              const wards = data.results;

              $('#wardCre').empty();

              $.each(wards, (index, item) => {
                const str = renderOptionWard(item);
                $('#wardCre').append(str);
              })
            })
            .fail((error) => {
              console.log(error);
            })
  }


  $("#provinceCre").on("change", function() {
    const provinceId = $(this).val();
    getAllDistrictsByProvinceId(provinceId, $("#districtCre"), function(data) {
      const districtId = data.results[0].district_id;
      getAllWardsByDistrictId(districtId, $("#wardCre"));
    });
  });
  $("#districtCre").on("change", function() {
    const districtId = $(this).val();
    getAllWardsByDistrictId(districtId, $("#wardCre"));
  });
  getAllProvinces();

  $('#btnCreate').on('click', function () {
    const provinceSelectCre = document.getElementById('provinceCre');
    const districtCre = document.getElementById('districtCre');
    const wardCre = document.getElementById('wardCre');
    const fullName = $('#fullNameCre').val();
    const staffName = $('#staffName').val();
    const password = $('#password').val();
    const email = $('#emailCre').val();
    const phone = $('#phoneCre').val();
    const age = $('#AgeCre').val()
    const provinceId = $('#provinceCre').val();
    const provinceName = provinceSelectCre.options[provinceSelectCre.selectedIndex].innerHTML;
    const districtId = $('#districtCre').val();
    const districtName = districtCre.options[districtCre.selectedIndex].innerHTML;
    const wardId = $('#wardCre').val();
    const wardName = wardCre.options[wardCre.selectedIndex].innerHTML;
    const address = $('#addressCre').val();

    const requestData = {
      fullName : fullName,
      staffName :staffName,
      password : password,
      email :email,
      phone :phone,
      age: age,
      locationRegion :{
        provinceId : provinceId,
        provinceName : provinceName,
        districtId : districtId,
        districtName : districtName,
        wardId : wardId,
        wardName : wardName,
        address : address
      }
    };
    console.log(requestData)
    $.ajax({
      type: 'POST',
      url: '/api/staffs/create',
      contentType:'application/json',
      data: JSON.stringify(requestData),
      success: function (response) {
        console.log(response);

        $('#modalCreate').modal('hide');
        document.getElementById("closeCreate").click();
        document.getElementById("create").reset();
        showStaff();

      },
      error: function (error) {
        console.log(error);
      }
    });
  });
</script>
</html>